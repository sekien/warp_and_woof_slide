(function(b){b.fn.WaWS=function(a){a=b.extend({warp:3,woof:3,data:[],launch:5,speed:300,spped_adjust:100,panel_size:100,auto_slide:{auto_run:!1,order:"forward",interval:1E4},view:{width:300,height:300,image_max_width:280,image_max_height:280,interval:5E3,open_url_target:"_blank",close:!0}},a);var y="#"+b(this).attr("id");0>=a.warp&&(a.warp=1);0>=a.woof&&(a.woof=1);if(a.launch>a.warp*a.woof||0>=a.launch)a.launch=1;a.auto_slide.auto_run||(a.auto_slide.auto_run=!1);a.auto_slide.order||(a.auto_slide.order=
"forward");a.auto_slide.interval||(a.auto_slide.interval=1E4);a.view.width||(a.view.width=300);a.view.height||(a.view.width=300);a.view.image_max_width||(a.view.image_max_width=280);a.view.image_max_height||(a.view.image_max_height=280);a.view.interval||(a.view.interval=5E3);a.view.open_url_target||(a.view.open_url_target="_blank");a.view.close||(a.view.close=!0);var K=1==a.auto_slide.auto_run?1:0,g=a.speed,l=a.woof*a.panel_size+"px",L=a.warp*a.panel_size+"px",H=a.launch,z,A,D=1,v=[],B=Math.floor(2*
Math.random());b(y).css({"font-size":"0",display:"inline-block","*display":"inline","*zoom":"1","letter-spacing":"-.40em",overflow:"hidden",position:"relative","text-align":"left","vertical-align":"top",padding:"0",width:l,height:L});for(var w=[],x=[],r,E={},C=a.data.length,l=0;l<C;l++)E[l]=new Image,E[l].src=a.data[l].image,F++;if(C>a.warp*a.woof){var F=0;w[F]=[];for(l=a.warp*a.woof;l<C;l++)w[F]=a.data[l],F++}var G,I=function(b){1==a.auto_slide.auto_run&&(G=setTimeout(function(){b.autoMove(G)},a.auto_slide.interval));
return G},t=function(){this.aww=[];this.aww[0]=[];this.panel_cnt=a.warp*a.woof;this.base_alt=this.bgselect=this.panels="";this.p_size=a.panel_size+"px";this.n_size=-1*a.panel_size+"px";for(var d=0,c=0,e=0,f=0;f<this.panel_cnt;f++)this.panels='<p id="waws_p'+(f+1)+'" class="waws_plate"><span></span></p>',this.bgselect="#waws_p"+(f+1)+" span",b(y).append(this.panels),f<C?b(this.bgselect).css("background-image","url("+a.data[f].image+")").attr("alt",a.data[f].title):(b(this.bgselect).css("background-image",
"url("+a.data[e].image+")").attr("alt",a.data[e].title),e++),c>a.woof-1&&(d++,this.aww[d]=[],c=0),this.aww[d][c]="waws_p"+(f+1),f==a.launch-1&&(z=d,A=c),c++;b(".waws_plate,.waws_plate span").css({width:this.p_size,height:this.p_size})};t.prototype.setPanel=function(a,b){B=0==B?1:0;this.slideAnimation(a,b,a<z?"d":a>z?"u":"n",b<A?"r":b>A?"l":"n")};t.prototype.slideAnimation=function(d,c,e,f){var p=[],q=[],g=[],k,m=function(f,m,u){"u"==e?(p=[m,"0"],v=[d-1,c]):"d"==e&&(p=[f,"0"],v=[d+1,c]);for(f=0;f<
a.warp;f++)k="#"+u[f][c]+" span",q[f]=b(k).css("background-image"),g[f]=b(k).attr("alt")},n=function(e,m,u){"l"==f?(p=["0",m],v=[d,c-1]):"r"==f?(p=["0",e],v=[d,c+1]):(p=["0","0"],v=[d,c]);for(e=0;e<a.woof;e++)k="#"+u[d][e]+" span",q[e]=b(k).css("background-image"),g[e]=b(k).attr("alt")};0==B?"n"!=e?m(this.p_size,this.n_size,this.aww):n(this.p_size,this.n_size,this.aww):"n"!=f?n(this.p_size,this.n_size,this.aww):m(this.p_size,this.n_size,this.aww);m=b.when(function(){x.hasOwnProperty("image")&&w.shift()}());
r=this;m.done(function(){r.setDummySpan(q,g,p,d,c,e,f)})};t.prototype.setDummySpan=function(d,c,e,f,p,q,g){var k,m,n="",l=function(c,d,e){k="#"+e[0][p]+" span";m="#"+e[a.warp-1][p]+" span";"u"==q?(n=b(k).css("background-image"),b(m).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("top",c)):"d"==q&&(n=b(m).css("background-image"),b(k).before(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("top",d))},J=function(c,e,d){k="#"+d[f][0]+" span";m="#"+
d[f][a.woof-1]+" span";"l"==g?(n=b(k).css("background-image"),b(m).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",c)):"r"==g&&(n=b(m).css("background-image"),b(k).before(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",e))};0==B?"n"!=q?l(this.p_size,this.n_size,this.aww):J(this.p_size,this.n_size,this.aww):"n"!=g?J(this.p_size,this.n_size,this.aww):l(this.p_size,this.n_size,this.aww);null!=w[0]&&(n="url("+w[0].image+")");l=b.when(b("#WaWS_dummy").css({"background-image":n,
width:this.p_size,height:this.p_size}));r=this;l.done(function(){r.slideAnimation2(d,c,e,f,p,q,g)})};t.prototype.slideAnimation2=function(d,c,e,f,p,q,l){var k="";r=this;var m={"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none","-webkit-transition":"none 0ms ease 0","-moz-transition":"none","-o-transition":"none 0ms ease 0","-ms-transition":"none 0ms ease 0","-transition":"none 0ms ease 0",left:"0",top:"0"},n=function(n){for(var u=0,h=0;h<
a.warp;h++)k="#"+n[h][p]+", +span ,+#WaWS_dummy",b(k).css({"-webkit-transform":"translateY("+e[0]+")","-moz-transform":"translateY("+e[0]+")","-o-transform":"translateY("+e[0]+")","-ms-transform":"translateY("+e[0]+")",transform:"translateY("+e[0]+")","-webkit-transition":g+"ms","-moz-transition":g+"ms","-o-transition":g+"ms","-ms-transition":g+"ms",transition:g+"ms"}).one("webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend",function(){b(this).css(m);u+=r.setSlidePanelvalue(d,
c,f,p,q,l,n);u==a.warp&&r.checkPanelPosition()})},t=function(n){for(var u=0,h=0;h<a.woof;h++)k="#"+n[f][h]+", +span ,+#WaWS_dummy",b(k).css({"-webkit-transform":"translateX("+e[1]+")","-moz-transform":"translateX("+e[1]+")","-o-transform":"translateX("+e[1]+")","-ms-transform":"translateX("+e[1]+")",transform:"translateX("+e[1]+")","-webkit-transition":g+"ms","-moz-transition":g+"ms","-o-transition":g+"ms","-ms-transition":g+"ms",transition:g+"ms"}).one("webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend",
function(){b(this).css(m);u+=r.setSlidePanelvalue(d,c,f,p,q,l,n);u==a.woof&&r.checkPanelPosition()})};0==B?"0"!=e[0]?n(this.aww):t(this.aww):"0"!=e[1]?t(this.aww):n(this.aww)};t.prototype.setSlidePanelvalue=function(d,c,e,f,p,q,g){var k="",m="";b("#WaWS_dummy").remove();var n=function(a){var c=[];if(null!=w[0])c.image=b(a).css("background-image"),c.title=b(a).attr("alt"),b(a).css("background-image","url("+w[0].image+")").attr("alt",w[0].title);else return!1;return c},l=function(e){var h=[];if("u"==
p){for(h=0;h<a.warp;h++)k="#"+e[h][f]+" span",b(k).css("background-image",d[h+1]).attr("alt",c[h+1]);b(k).css("background-image",d[0]).attr("alt",c[0]);h=n(k)}else if("d"==p){for(h=0;h<a.warp;h++)k="#"+e[h][f]+" span",0==h?b(k).css("background-image",d[d.length-1]).attr("alt",c[c.length-1]):b(k).css("background-image",d[h-1]).attr("alt",c[h-1]);m="#"+e[0][f]+" span";h=n(m)}return h},r=function(f){var h=[];if("l"==q){for(h=0;h<a.woof;h++)k="#"+f[e][h]+" span",b(k).css("background-image",d[h+1]).attr("alt",
c[h+1]);b(k).css("background-image",d[0]).attr("alt",c[0]);h=n(k)}else if("r"==q){for(h=0;h<a.woof;h++)k="#"+f[e][h]+" span",0==h?b(k).css("background-image",d[d.length-1]).attr("alt",c[c.length-1]):b(k).css("background-image",d[h-1]).attr("alt",c[h-1]);m="#"+f[e][0]+" span";h=n(m)}return h};x=0==B?"n"!=p?l(g):r(g):"n"!=q?r(g):l(g);return 1};t.prototype.checkPanelPosition=function(){r=this;if(v[0]==z&&v[1]==A)var b=setTimeout(function(){r.openLargeWindow(b)},a.spped_adjust);else setTimeout(function(){r.reserveDataPush(1)},
a.spped_adjust)};t.prototype.reserveDataPush=function(b){var c=0;if(x.image){x.image=x.image.replace("url(","");x.image=x.image.replace(")","");for(var e=this.base_alt,f=0;f<C;f++)if(f in a.data&&a.data[f].title===e){c=f;break}w.push({image:x.image,url:a.data[c].url,title:x.title})}1==b&&this.setPanel(v[0],v[1])};t.prototype.openLargeWindow=function(d){clearTimeout(d);this.reserveDataPush();d=this.base_alt;var c=0;r=this;for(var e=0;e<C;e++)if(e in a.data&&a.data[e].title===d){c=e;break}b(y).after('<p id="WaWSlargeview"><span></span></p>');
d=b(y).offset();b("#WaWSlargeview").css({left:d.left+b(y).width()/2+"px",top:d.top+b(y).height()/2+"px"});var f=E[c].width,p=E[c].height,q,e=f>p?a.view.image_max_width+"px auto":"auto "+a.view.image_max_height+"px";b("#WaWSlargeview span").css("background-size",e);b("#WaWSlargeview span").attr("title",a.data[c].title);b("#WaWSlargeview").show().css({border:"1px solid #000",left:d.left+b(y).width()/2-a.view.width/2+"px",top:d.top+b(y).height()/2-a.view.height/2+"px",width:a.view.width,height:a.view.height,
"-webkit-transition-property":"width,height","-moz-transition-property":"width,height","-o-transition-property":"width,height","-ms-transition-property":"width,height","transition-property":"width,height","-webkit-transition":g+"ms","-moz-transition":g+"ms","-o-transition":g+"ms","-ms-transition":g+"ms",transition:g+"ms"}).one("webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend",function(){1!=a.view.close||b("#WaWSclose")[0]||b("#WaWSlargeview").append('<div id="WaWSclose"></div>');
b("#WaWSlargeview span").css({"background-image":"url("+a.data[c].image+")",width:f+"px",height:p+"px","vertical-align":"middle","margin-top":(a.view.height-a.view.image_max_height)/2+"px","margin-left":"auto","margin-right":"auto","max-width":a.view.image_max_width+"px","max-height":a.view.image_max_height+"px"});b("#WaWSclose").css({left:a.view.width-b("#WaWSclose").width()+"px"})});var l=function(){b("#WaWSlargeview span,#WaWSclose").remove();b("#WaWSlargeview").css({opacity:"0","-webkit-transform":"scale(0.1)",
"-moz-transform":"scale(0.1)","-o-transform":"scale(0.1)","-ms-transform":"scale(0.1)",transform:"scale(0.1)","-webkit-transition":g+"ms","-moz-transition":g+"ms","-o-transition":g+"ms","-ms-transition":g+"ms",transition:g+"ms"}).one("webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend",function(){b("#WaWSlargeview").remove();clearTimeout(q);q=null;D=1;1==K&&(a.auto_slide.auto_run=!0,I(r))})};(function(){q=setTimeout(function(){l()},a.view.interval)})();b("#WaWSlargeview span").on("click",
function(){""==a.data[c].url?q&&l():window.open(a.data[c].url,a.view.open_url_target)});b(document).on("click","#WaWSclose",function(){q&&l()})};t.prototype.autoMove=function(d){(function(b){a.auto_slide.auto_run=!1;clearTimeout(b)})(d);D=0;var c=[];d=function(b){for(var c=[],d=0;d<a.warp;d++)for(var g=0;g<a.woof;g++)if(d in this.aww&&this.aww[d][g]===b){c[0]=d;c[1]=g;break}return c};"forward"==a.auto_slide.order?(c="waws_p"+(H-1),b("#"+c)[0]||(c="waws_p"+this.panel_cnt),c=d(c)):"back"==a.auto_slide.order?
(c="waws_p"+(H+1),b("#"+c)[0]||(c="waws_p1"),c=d(c)):(c[0]=Math.floor(Math.random()*a.warp),c[1]=Math.floor(Math.random()*a.woof),c[0]==z&&c[1]==A&&(c=0!=c[0]&&0!=c[1]?[0,0]:[a.warp-1,a.woof-1]));this.base_alt=b("#"+this.aww[c[0]][c[1]]+" span").attr("alt");c[0]==z&&c[1]==A?this.openLargeWindow():this.setPanel(c[0],c[1])};this.each(function(){var d=new t;if(1==D)var c=I(d);b(".waws_plate").bind("click",function(){if(1==D){D=0;a.auto_slide.auto_run=!1;clearTimeout(G);var c=b(this).attr("id");d.base_alt=
b("#"+c+" span").attr("alt");for(var f,g,l=0;l<a.warp&&!(f=l,g=d.aww[l].lastIndexOf(c),-1<g);l++);f==z&&g==A?d.openLargeWindow():d.setPanel(f,g)}});b("#WaWSstopAutoRun").click(function(){c&&(clearTimeout(c),a.auto_slide.auto_run=!1,console.log("stop auto-run"))})});return this}})(jQuery);