(function(b){b.fn.WaWS=function(a){a=b.extend({warp:3,woof:3,data:[],launch:5,speed:300,spped_adjust:100,panel_size:100,auto_slide:{auto_run:!1,order:"forward",interval:1E4},view:{width:300,height:300,image_max_width:280,image_max_height:280,interval:5E3,open_url_target:"_blank",close:!0}},a);var x="#"+b(this).attr("id");0>=a.warp&&(a.warp=1);0>=a.woof&&(a.woof=1);if(a.launch>a.warp*a.woof||0>=a.launch)a.launch=1;a.auto_slide.auto_run||(a.auto_slide.auto_run=!1);a.auto_slide.order||(a.auto_slide.order=
"forward");a.auto_slide.interval||(a.auto_slide.interval=1E4);a.view.width||(a.view.width=300);a.view.height||(a.view.width=300);a.view.image_max_width||(a.view.image_max_width=280);a.view.image_max_height||(a.view.image_max_height=280);a.view.interval||(a.view.interval=5E3);a.view.open_url_target||(a.view.open_url_target="_blank");a.view.close||(a.view.close=!0);var K=1==a.auto_slide.auto_run?1:0,f=a.speed,l=a.woof*a.panel_size+"px",L=a.warp*a.panel_size+"px",H=a.launch,y,z,D=1,u=[],A=Math.floor(2*
Math.random());b(x).css({"font-size":"0",display:"inline-block","*display":"inline","*zoom":"1","letter-spacing":"-.40em",overflow:"hidden",position:"relative","text-align":"left","vertical-align":"top",padding:"0",width:l,height:L});for(var v=[],w=[],n,E={},l=0;l<a.data.length;l++)E[l]=new Image,E[l].src=a.data[l].image,F++;if(a.data.length>a.warp*a.woof){var F=0;v[F]=[];for(l=a.warp*a.woof;l<a.data.length;l++)v[F]=a.data[l],F++}var G,I=function(b){1==a.auto_slide.auto_run&&(G=setTimeout(function(){b.autoMove(G)},
a.auto_slide.interval));return G},r=function(){this.aww=[];this.aww[0]=[];this.panel_cnt=a.warp*a.woof;this.base_alt=this.bgselect=this.panels="";this.p_size=a.panel_size+"px";this.n_size=-1*a.panel_size+"px";for(var d=0,c=0,e=0,g=0;g<this.panel_cnt;g++)this.panels='<p id="waws_p'+(g+1)+'" class="waws_plate"><span></span></p>',this.bgselect="#waws_p"+(g+1)+" span",b(x).append(this.panels),g<a.data.length?b(this.bgselect).css("background-image","url("+a.data[g].image+")").attr("alt",a.data[g].title):
(b(this.bgselect).css("background-image","url("+a.data[e].image+")").attr("alt",a.data[e].title),e++),c>a.woof-1&&(d++,this.aww[d]=[],c=0),this.aww[d][c]="waws_p"+(g+1),g==a.launch-1&&(y=d,z=c),c++;b(".waws_plate,.waws_plate span").css({width:this.p_size,height:this.p_size})};r.prototype.setPanel=function(a,b){A=0==A?1:0;this.slideAnimation(a,b,a<y?"d":a>y?"u":"n",b<z?"r":b>z?"l":"n")};r.prototype.slideAnimation=function(d,c,e,g){var q=[],B=[],p=[],k,f=function(g,f,t){"u"==e?(q=[f,"0"],u=[d-1,c]):
"d"==e&&(q=[g,"0"],u=[d+1,c]);for(g=0;g<a.warp;g++)k="#"+t[g][c]+" span",B[g]=b(k).css("background-image"),p[g]=b(k).attr("alt")},m=function(e,f,t){"l"==g?(q=["0",f],u=[d,c-1]):"r"==g?(q=["0",e],u=[d,c+1]):(q=["0","0"],u=[d,c]);for(e=0;e<a.woof;e++)k="#"+t[d][e]+" span",B[e]=b(k).css("background-image"),p[e]=b(k).attr("alt")};0==A?"n"!=e?f(this.p_size,this.n_size,this.aww):m(this.p_size,this.n_size,this.aww):"n"!=g?m(this.p_size,this.n_size,this.aww):f(this.p_size,this.n_size,this.aww);f=b.when(function(){w.hasOwnProperty("image")&&
v.shift()}());n=this;f.done(function(){n.setDummySpan(B,p,q,d,c,e,g)})};r.prototype.setDummySpan=function(d,c,e,g,q,f,p){var k,C,m="",l=function(c,d,e){k="#"+e[0][q]+" span";C="#"+e[a.warp-1][q]+" span";"u"==f?(m=b(k).css("background-image"),b(C).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("top",c)):"d"==f&&(m=b(C).css("background-image"),b(k).before(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("top",d))},J=function(c,e,d){k="#"+d[g][0]+
" span";C="#"+d[g][a.woof-1]+" span";"l"==p?(m=b(k).css("background-image"),b(C).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",c)):"r"==p&&(m=b(C).css("background-image"),b(k).before(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",e))};0==A?"n"!=f?l(this.p_size,this.n_size,this.aww):J(this.p_size,this.n_size,this.aww):"n"!=p?J(this.p_size,this.n_size,this.aww):l(this.p_size,this.n_size,this.aww);null!=v[0]&&(m="url("+v[0].image+
")");l=b.when(b("#WaWS_dummy").css({"background-image":m,width:this.p_size,height:this.p_size}));n=this;l.done(function(){n.slideAnimation2(d,c,e,g,q,f,p)})};r.prototype.slideAnimation2=function(d,c,e,g,q,B,p){var k="";n=this;var l={"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none","-webkit-transition":"none 0ms ease 0","-moz-transition":"none 0ms ease 0","-o-transition":"none 0ms ease 0","-ms-transition":"none 0ms ease 0","-transition":"none 0ms ease 0",
left:"0",top:"0"},m=function(m){for(var t=0,h=0;h<a.warp;h++)k="#"+m[h][q]+", +span ,+#WaWS_dummy",b(k).css({"-webkit-transform":"translateY("+e[0]+")","-moz-transform":"translateY("+e[0]+")","-o-transform":"translateY("+e[0]+")","-ms-transform":"translateY("+e[0]+")",transform:"translateY("+e[0]+")","-webkit-transition":f+"ms","-moz-transition":f+"ms","-o-transition":f+"ms","-ms-transition":f+"ms",transition:f+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(){b(this).css(l);
t+=n.setSlidePanelvalue(d,c,g,q,B,p,m);t==a.warp&&n.checkPanelPosition()})},r=function(m){for(var t=0,h=0;h<a.woof;h++)k="#"+m[g][h]+", +span ,+#WaWS_dummy",b(k).css({"-webkit-transform":"translateX("+e[1]+")","-moz-transform":"translateX("+e[1]+")","-o-transform":"translateX("+e[1]+")","-ms-transform":"translateX("+e[1]+")",transform:"translateX("+e[1]+")","-webkit-transition":f+"ms","-moz-transition":f+"ms","-o-transition":f+"ms","-ms-transition":f+"ms",transition:f+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",
function(){b(this).css(l);t+=n.setSlidePanelvalue(d,c,g,q,B,p,m);t==a.woof&&n.checkPanelPosition()})};0==A?"0"!=e[0]?m(this.aww):r(this.aww):"0"!=e[1]?r(this.aww):m(this.aww)};r.prototype.setSlidePanelvalue=function(d,c,e,g,q,f,p){var k="",l="";b("#WaWS_dummy").remove();var m=function(a){var c=[];if(null!=v[0])c.image=b(a).css("background-image"),c.title=b(a).attr("alt"),b(a).css("background-image","url("+v[0].image+")").attr("alt",v[0].title);else return!1;return c},n=function(e){var h=[];if("u"==
q){for(h=0;h<a.warp;h++)k="#"+e[h][g]+" span",b(k).css("background-image",d[h+1]).attr("alt",c[h+1]);b(k).css("background-image",d[0]).attr("alt",c[0]);h=m(k)}else if("d"==q){for(h=0;h<a.warp;h++)k="#"+e[h][g]+" span",0==h?b(k).css("background-image",d[d.length-1]).attr("alt",c[c.length-1]):b(k).css("background-image",d[h-1]).attr("alt",c[h-1]);l="#"+e[0][g]+" span";h=m(l)}return h},r=function(g){var h=[];if("l"==f){for(h=0;h<a.woof;h++)k="#"+g[e][h]+" span",b(k).css("background-image",d[h+1]).attr("alt",
c[h+1]);b(k).css("background-image",d[0]).attr("alt",c[0]);h=m(k)}else if("r"==f){for(h=0;h<a.woof;h++)k="#"+g[e][h]+" span",0==h?b(k).css("background-image",d[d.length-1]).attr("alt",c[c.length-1]):b(k).css("background-image",d[h-1]).attr("alt",c[h-1]);l="#"+g[e][0]+" span";h=m(l)}return h};w=0==A?"n"!=q?n(p):r(p):"n"!=f?r(p):n(p);return 1};r.prototype.checkPanelPosition=function(){n=this;if(u[0]==y&&u[1]==z)var b=setTimeout(function(){n.openLargeWindow(b)},a.spped_adjust);else setTimeout(function(){n.reserveDataPush(1)},
a.spped_adjust)};r.prototype.reserveDataPush=function(b){var c=0;if(w.image){w.image=w.image.replace("url(","");w.image=w.image.replace(")","");for(var e=this.base_alt,g=a.data.length,f=0;f<g;f++)if(f in a.data&&a.data[f].title===e){c=f;break}v.push({image:w.image,url:a.data[c].url,title:w.title})}1==b&&this.setPanel(u[0],u[1])};r.prototype.openLargeWindow=function(d){clearTimeout(d);this.reserveDataPush();d=this.base_alt;var c=0;n=this;for(var e=0,g=a.data.length;e<g;e++)if(e in a.data&&a.data[e].title===
d){c=e;break}b(x).after('<p id="WaWSlargeview"><span></span></p>');d=b(x).offset();b("#WaWSlargeview").css({left:d.left+b(x).width()/2+"px",top:d.top+b(x).height()/2+"px"});var q=E[c].width,l=E[c].height,p,e=q>l?a.view.image_max_width+"px auto":"auto "+a.view.image_max_height+"px";b("#WaWSlargeview span").css("background-size",e);b("#WaWSlargeview span").attr("title",a.data[c].title);b("#WaWSlargeview").show().css({border:"1px solid #000",left:d.left+b(x).width()/2-a.view.width/2+"px",top:d.top+b(x).height()/
2-a.view.height/2-16+"px",width:a.view.width,height:a.view.height,"-webkit-transition-property":"width,height","-moz-transition-property":"width,height","-o-transition-property":"width,height","-ms-transition-property":"width,height","transition-property":"width,height","-webkit-transition":f+"ms","-moz-transition":f+"ms","-o-transition":f+"ms","-ms-transition":f+"ms",transition:f+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(){1!=a.view.close||b("#WaWSclose")[0]||
b("#WaWSlargeview").append('<div id="WaWSclose"></div>');b("#WaWSlargeview span").css({"background-image":"url("+a.data[c].image+")",width:q+"px",height:l+"px","vertical-align":"middle","margin-top":(a.view.height-a.view.image_max_height)/2+"px","margin-left":"auto","margin-right":"auto","max-width":a.view.image_max_width+"px","max-height":a.view.image_max_height+"px"});b("#WaWSclose").css({left:a.view.width-b("#WaWSclose").width()+"px"})});var k=function(){b("#WaWSlargeview span,#WaWSclose").remove();
b("#WaWSlargeview").css({opacity:"0","-webkit-transform":"scale(0.1)","-moz-transform":"scale(0.1)","-o-transform":"scale(0.1)","-ms-transform":"scale(0.1)",transform:"scale(0.1)","-webkit-transition":f+"ms","-moz-transition":f+"ms","-o-transition":f+"ms","-ms-transition":f+"ms",transition:f+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(){b("#WaWSlargeview").remove();clearTimeout(p);p=null;D=1;1==K&&(a.auto_slide.auto_run=!0,I(n))})};(function(){p=setTimeout(function(){k()},
a.view.interval)})();b("#WaWSlargeview span").on("click",function(){""==a.data[c].url?p&&k():window.open(a.data[c].url,a.view.open_url_target)});b(document).on("click","#WaWSclose",function(){p&&k()})};r.prototype.autoMove=function(d){(function(b){a.auto_slide.auto_run=!1;clearTimeout(b)})(d);D=0;var c=[];d=function(b){for(var c=[],d=0;d<a.warp;d++)for(var f=0;f<a.woof;f++)if(d in this.aww&&this.aww[d][f]===b){c[0]=d;c[1]=f;break}return c};"forward"==a.auto_slide.order?(c="waws_p"+(H-1),b("#"+c)[0]||
(c="waws_p"+this.panel_cnt),c=d(c)):"back"==a.auto_slide.order?(c="waws_p"+(H+1),b("#"+c)[0]||(c="waws_p1"),c=d(c)):(c[0]=Math.floor(Math.random()*a.warp),c[1]=Math.floor(Math.random()*a.woof),c[0]==y&&c[1]==z&&(c=0!=c[0]&&0!=c[1]?[0,0]:[a.warp-1,a.woof-1]));this.base_alt=b("#"+this.aww[c[0]][c[1]]+" span").attr("alt");c[0]==y&&c[1]==z?this.openLargeWindow():this.setPanel(c[0],c[1])};this.each(function(){var d=new r;if(1==D)var c=I(d);b(".waws_plate").bind("click",function(){if(1==D){D=0;a.auto_slide.auto_run=
!1;clearTimeout(G);var c=b(this).attr("id");d.base_alt=b("#"+c+" span").attr("alt");for(var f,l,n=0;n<a.warp&&!(f=n,l=d.aww[n].lastIndexOf(c),-1<l);n++);f==y&&l==z?d.openLargeWindow():d.setPanel(f,l)}});b("#WaWSstopAutoRun").click(function(){c&&(clearTimeout(c),a.auto_slide.auto_run=!1,console.log("stop auto-run"))})});return this}})(jQuery);