(function(b){b.fn.WaWS=function(a){a=b.extend({warp:3,woof:3,data:[],launch:5,speed:300,spped_ajust:100,panel_size:100,auto_slide:{auto_run:!1,order:"forward",interval:1E4},view:{width:300,height:300,image_max_width:280,image_max_height:280,interval:5E3,open_url_target:"_blank",close:!0}},a);var m="#"+b(this).attr("id");0>=a.warp&&(a.warp=1);0>=a.woof&&(a.woof=1);if(a.launch>a.warp*a.woof||0>=a.launch)a.launch=1;var d=a.speed,k=a.woof*a.panel_size+"px",F=a.warp*a.panel_size+"px",D=a.launch,t,w,A=
1,q=[],x=Math.floor(2*Math.random());b(m).css({"font-size":"0",display:"inline-block","*display":"inline","*zoom":"1","letter-spacing":"-.40em",overflow:"hidden",position:"relative","text-align":"left","vertical-align":"top",padding:"0",width:k,height:F});for(var u=[],v=[],y,B={},k=0;k<a.data.length;k++)B[k]=new Image,B[k].src=a.data[k].image,C++;if(a.data.length>a.warp*a.woof){var C=0;u[C]=[];for(k=a.warp*a.woof;k<a.data.length;k++)u[C]=a.data[k],C++}var E=function(b){if(1==a.auto_slide.auto_run)var c=
setTimeout(function(){b.autoMove(c)},a.auto_slide.interval);return c},p=function(){this.aww=[];this.aww[0]=[];this.panel_cnt=a.warp*a.woof;this.base_alt=this.bgselect=this.panels="";this.p_size=a.panel_size+"px";this.n_size=-1*a.panel_size+"px";for(var h=0,c=0,f=0,e=0;e<this.panel_cnt;e++)this.panels='<p id="waws_p'+(e+1)+'" class="waws_plate"><span></span></p>',this.bgselect="#waws_p"+(e+1)+" span",b(m).append(this.panels),e<a.data.length?(b(this.bgselect).css("background-image","url("+a.data[e].image+
")"),b(this.bgselect).attr("alt",a.data[e].title)):(b(this.bgselect).css("background-image","url("+a.data[f].image+")"),b(this.bgselect).attr("alt",a.data[f].title),f++),c>a.woof-1&&(h++,this.aww[h]=[],c=0),this.aww[h][c]="waws_p"+(e+1),e==a.launch-1&&(t=h,w=c),c++;b(".waws_plate,.waws_plate span").css({width:this.p_size,height:this.p_size})};p.prototype.setPanel=function(a,b){this.slideAnimation(a,b,a<t?"d":a>t?"u":"n",b<w?"r":b>w?"l":"n")};p.prototype.slideAnimation=function(h,c,f,e){var l=[],n=
[],z=[],g,r=function(e,G,d){"u"==f?(l=[G,"0"],q=[h-1,c]):"d"==f&&(l=[e,"0"],q=[h+1,c]);for(e=0;e<a.warp;e++)g="#"+d[e][c]+" span",n[e]=b(g).css("background-image"),z[e]=b(g).attr("alt")},d=function(f,d,r){"l"==e?(l=["0",d],q=[h,c-1]):"r"==e?(l=["0",f],q=[h,c+1]):(l=["0","0"],q=[h,c]);for(f=0;f<a.woof;f++)g="#"+r[h][f]+" span",n[f]=b(g).css("background-image"),z[f]=b(g).attr("alt")};0==x?"n"!=f?r(this.p_size,this.n_size,this.aww):d(this.p_size,this.n_size,this.aww):"n"!=e?d(this.p_size,this.n_size,
this.aww):r(this.p_size,this.n_size,this.aww);v.hasOwnProperty("image")&&u.shift();this.setDummySpan(h,c,f,e);this.slideAnimation2(n,z,l,h,c,f,e)};p.prototype.setDummySpan=function(h,c,f,e){var l,n,d="",g=function(h,e,g){l="#"+g[0][c]+" span";n="#"+g[a.warp-1][c]+" span";"u"==f?(d=b(l).css("background-image"),b(n).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("top",h)):"d"==f&&(d=b(n).css("background-image"),b(l).before(function(){return'<span id="WaWS_dummy"></span>'}),
b("#WaWS_dummy").css("top",e))},r=function(c,f,g){l="#"+g[h][0]+" span";n="#"+g[h][a.woof-1]+" span";"l"==e?(d=b(l).css("background-image"),b(n).after(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",c)):"r"==e&&(d=b(n).css("background-image"),b(l).before(function(){return'<span id="WaWS_dummy"></span>'}),b("#WaWS_dummy").css("left",f))};0==x?"n"!=f?g(this.p_size,this.n_size,this.aww):r(this.p_size,this.n_size,this.aww):"n"!=e?r(this.p_size,this.n_size,this.aww):g(this.p_size,
this.n_size,this.aww);null!=u[0]&&(d="url("+u[0].image+")");b("#WaWS_dummy").css({"background-image":d,width:this.p_size,height:this.p_size})};p.prototype.slideAnimation2=function(h,c,f,e,l,n,z){var g="",r={"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none","-webkit-transition":"0","-moz-transition":"0ms","-o-transition":"0","-ms-transition":"0","-transition":"0",left:"0px",top:"0px"},k=function(k){for(var m=0;m<a.warp;m++)g="#"+k[m][l]+
", +span ,+#WaWS_dummy",b(g).css({"-webkit-transform":"translateY("+f[0]+")","-moz-transform":"translateY("+f[0]+")","-o-transform":"translateY("+f[0]+")","-ms-transform":"translateY("+f[0]+")",transform:"translateY("+f[0]+")","-webkit-transition":d+"ms","-moz-transition":d+"ms","-o-transition":d+"ms","-ms-transition":d+"ms",transition:d+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(){b(this).css(r);p.prototype.setSlidePanelvalue(h,c,e,l,n,z,k)})},m=function(m){for(var k=
0;k<a.woof;k++)g="#"+m[e][k]+", +span ,+#WaWS_dummy",b(g).css({"-webkit-transform":"translateX("+f[1]+")","-moz-transform":"translateX("+f[1]+")","-o-transform":"translateX("+f[1]+")","-ms-transform":"translateX("+f[1]+")",transform:"translateX("+f[1]+")","-webkit-transition":d+"ms","-moz-transition":d+"ms","-o-transition":d+"ms","-ms-transition":d+"ms",transition:d+"ms"}).one("webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(){b(this).css(r);p.prototype.setSlidePanelvalue(h,
c,e,l,n,z,m)})};0==x?"0"!=f[0]?k(this.aww):m(this.aww):"0"!=f[1]?m(this.aww):k(this.aww);this.checkPanelPosition()};p.prototype.setSlidePanelvalue=function(h,c,f,e,l,n,d){var g="",k="";b("#WaWS_dummy").remove();var m=function(a){var c=[];if(null!=u[0])c.image=b(a).css("background-image"),c.title=b(a).attr("alt"),b(a).css("background-image","url("+u[0].image+")"),b(a).attr("alt",u[0].title);else return!1;return c},p=function(f){var d=[];if("u"==l){for(d=0;d<a.warp;d++)g="#"+f[d][e]+" span",b(g).css("background-image",
h[d+1]),b(g).attr("alt",c[d+1]);b(g).css("background-image",h[0]);b(g).attr("alt",c[0]);d=m(g)}else if("d"==l){for(d=0;d<a.warp;d++)g="#"+f[d][e]+" span",0==d?(b(g).css("background-image",h[h.length-1]),b(g).attr("alt",c[c.length-1])):(b(g).css("background-image",h[d-1]),b(g).attr("alt",c[d-1]));k="#"+f[0][e]+" span";d=m(k)}return d},q=function(d){var e=[];if("l"==n){for(e=0;e<a.woof;e++)g="#"+d[f][e]+" span",b(g).css("background-image",h[e+1]),b(g).attr("alt",c[e+1]);b(g).css("background-image",
h[0]);b(g).attr("alt",c[0]);e=m(g)}else if("r"==n){for(e=0;e<a.woof;e++)g="#"+d[f][e]+" span",0==e?(b(g).css("background-image",h[h.length-1]),b(g).attr("alt",c[c.length-1])):(b(g).css("background-image",h[e-1]),b(g).attr("alt",c[e-1]));k="#"+d[f][0]+" span";e=m(k)}return e},t=[];v=t=0==x?"n"!=l?p(d):q(d):"n"!=n?q(d):p(d)};p.prototype.checkPanelPosition=function(){var b=this.base_alt;y=this;if(q[0]==t&&q[1]==w)var c=setTimeout(function(){y.openLargeWindow(c)},d+a.spped_ajust);else setTimeout(function(){y.reserveDataPush(b);
x=0==x?1:0;y.setPanel(q[0],q[1])},d+a.spped_ajust)};p.prototype.reserveDataPush=function(){if(v.image){v.image=v.image.replace("url(","");v.image=v.image.replace(")","");for(var b=this.base_alt,c=0,f=0,e=a.data.length;f<e;f++)if(f in a.data&&a.data[f].title===b){c=f;break}}else return!1;u.push({image:v.image,url:a.data[c].url,title:v.title})};p.prototype.openLargeWindow=function(h){clearTimeout(h);this.reserveDataPush();h=this.base_alt;var c=0;y=this;for(var f=0,e=a.data.length;f<e;f++)if(f in a.data&&
a.data[f].title===h){c=f;break}b(m).after('<p id="WaWSlargeview"><span></span></p>');var l=b(m).offset();b("#WaWSlargeview").css({left:l.left+b(m).width()/2+"px",top:l.top+b(m).height()/2+"px"});B[c].src=a.data[c].image;var n=B[c].width,k=B[c].height,g;h=n>k?a.view.image_max_width+"px auto":"auto "+a.view.image_max_height+"px";b("#WaWSlargeview span").css("background-size",h);b("#WaWSlargeview span").attr("title",a.data[c].title);b("#WaWSlargeview").show().animate({left:l.left+b(m).width()/2-a.view.width/
2+"px",top:l.top+b(m).height()/2-a.view.height/2-16+"px",width:a.view.width,height:a.view.height},d,function(){1==a.view.close&&b("#WaWSlargeview").append('<div id="WaWSclose"></div>');b("#WaWSlargeview span").css({"background-image":"url("+a.data[c].image+")",width:n+"px",height:k+"px","vertical-align":"middle","margin-top":(a.view.height-a.view.image_max_height)/2+"px","margin-left":"auto","margin-right":"auto","max-width":a.view.image_max_width+"px","max-height":a.view.image_max_height+"px"});
b("#WaWSclose").css({left:a.view.width-b("#WaWSclose").width()+"px"})});var p=function(){b("#WaWSlargeview span,#WaWSclose").remove();b.when(b("#WaWSlargeview").animate({opacity:"hide",left:l.left+b(m).width()/2+"px",top:l.top+b(m).height()/2+"px",width:"1px",height:"1px"},d)).done(function(){b("#WaWSlargeview").remove();clearTimeout(g);g=null;A=1;E(y)})};(function(){g=setTimeout(function(){p()},a.view.interval)})();b("#WaWSlargeview span").on("click",function(){""==a.data[c].url?g&&p():window.open(a.data[c].url,
a.view.open_url_target)});b(document).on("click","#WaWSclose",function(){g&&p()})};p.prototype.autoMove=function(d){clearTimeout(d);A=0;var c=[];d=function(b){for(var c=[],d=0;d<a.warp;d++)for(var h=0;h<a.woof;h++)if(d in this.aww&&this.aww[d][h]===b){c[0]=d;c[1]=h;break}return c};"forward"==a.auto_slide.order?(c="waws_p"+(D-1),b("#"+c)[0]||(c="waws_p"+this.panel_cnt),c=d(c)):"back"==a.auto_slide.order?(c="waws_p"+(D+1),b("#"+c)[0]||(c="waws_p1"),c=d(c)):(c[0]=Math.floor(Math.random()*a.warp),c[1]=
Math.floor(Math.random()*a.woof),c[0]==t&&c[1]==w&&(c=0!=c[0]&&0!=c[1]?[0,0]:[a.warp-1,a.woof-1]));this.base_alt=b("#"+this.aww[c[0]][c[1]]+" span").attr("alt");c[0]==t&&c[1]==w?this.openLargeWindow():this.setPanel(c[0],c[1])};this.each(function(){var d=new p;b(".waws_plate").bind("click",function(){if(1==A){A=0;var c=b(this).attr("id");d.base_alt=b("#"+c+" span").attr("alt");for(var e,l,k=0;k<a.warp&&!(e=k,l=d.aww[k].lastIndexOf(c),-1<l);k++);e==t&&l==w?d.openLargeWindow():d.setPanel(e,l)}});var c;
1==A&&(c=E(d));b("#WaWSstopAutoRun").click(function(){c&&(clearTimeout(c),a.auto_slide.auto_run=!1,console.log("stop auto-run"))})});return this}})(jQuery);